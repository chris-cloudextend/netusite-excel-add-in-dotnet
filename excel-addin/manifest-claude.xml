<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!--
XAVI for NetSuite - Excel Add-in Manifest

Copyright (c) 2025 Celigo, Inc.
All rights reserved.

This source code is proprietary and confidential. Unauthorized copying,
modification, distribution, or use of this software, via any medium,
is strictly prohibited without the express written permission of Celigo, Inc.

For licensing inquiries, contact: legal@celigo.com

ARCHITECTURE (v3.0.5.190+):
- SharedRuntime page: sharedruntime.html (BLANK - no UI, hosts commands)
- Taskpane UI page: taskpane.html (actual UI)
- This separation ensures Mac's "Developer Window" is blank, not a duplicate UI

Context menu uses ExecuteFunction (runs in blank sharedruntime.html):
1. ExecuteFunction sets localStorage flag with cell info
2. ExecuteFunction calls Office.addin.showAsTaskpane()
3. Taskpane reads flag and performs drill-down with UI
-->
<OfficeApp 
  xmlns="http://schemas.microsoft.com/office/appforoffice/1.1" 
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xmlns:bt="http://schemas.microsoft.com/office/officeappbasictypes/1.0"
  xmlns:ov="http://schemas.microsoft.com/office/taskpaneappversionoverrides"
  xsi:type="TaskPaneApp">

  <Id>c3d4e5f6-7890-12ab-cdef-345678901cde</Id>
  <Version>3.0.5.233</Version>
  <ProviderName>CloudExtend</ProviderName>
  <DefaultLocale>en-US</DefaultLocale>
  <DisplayName DefaultValue="XAVI for NetSuite"/>
  <Description DefaultValue="XAVI - Financial reporting formulas for NetSuite"/>
  <IconUrl DefaultValue="https://chris-cloudextend.github.io/netsuite-excel-addin/icon-32.png?v=3.0.5.233"/>
  <HighResolutionIconUrl DefaultValue="https://chris-cloudextend.github.io/netsuite-excel-addin/icon-64.png?v=3.0.5.233"/>
  <SupportUrl DefaultValue="https://www.cloudextend.io"/>

  <Hosts>
    <Host Name="Workbook"/>
  </Hosts>

  <!-- Requirements - SharedRuntime for unified context -->
  <Requirements>
    <Sets DefaultMinVersion="1.1">
      <Set Name="SharedRuntime" MinVersion="1.1"/>
    </Sets>
  </Requirements>

  <!-- Task Pane (fallback for older Office versions) -->
  <DefaultSettings>
    <SourceLocation DefaultValue="https://chris-cloudextend.github.io/netsuite-excel-addin/taskpane.html?v=3.0.5.233"/>
  </DefaultSettings>

  <Permissions>ReadWriteDocument</Permissions>

  <VersionOverrides xmlns="http://schemas.microsoft.com/office/taskpaneappversionoverrides"
                    xsi:type="VersionOverridesV1_0">

    <Hosts>
      <Host xsi:type="Workbook">

        <!-- SHARED RUNTIME - Points to BLANK page (no UI) -->
        <!-- On Mac, this opens as "Developer Window" - keeping it blank prevents duplicate UI -->
        <Runtimes>
          <Runtime resid="SharedRuntime.Url" lifetime="long"/>
        </Runtimes>

        <!-- Custom Functions - Uses shared runtime (blank page) -->
        <AllFormFactors>
          <ExtensionPoint xsi:type="CustomFunctions">
            <Script>
              <SourceLocation resid="Functions.Script.Url"/>
            </Script>
            <Page>
              <SourceLocation resid="SharedRuntime.Url"/>
            </Page>
            <Metadata>
              <SourceLocation resid="Functions.Metadata.Url"/>
            </Metadata>
            <Namespace resid="Functions.Namespace"/>
          </ExtensionPoint>
        </AllFormFactors>

        <!-- Desktop UI (Ribbon + Context Menu) -->
        <DesktopFormFactor>
          <!-- GetStarted for auto-launch with shared runtime -->
          <GetStarted>
            <Title resid="GetStarted.Title"/>
            <Description resid="GetStarted.Description"/>
            <LearnMoreUrl resid="GetStarted.LearnMoreUrl"/>
          </GetStarted>

          <!-- FunctionFile uses shared runtime (blank page) -->
          <FunctionFile resid="SharedRuntime.Url"/>

          <!-- Ribbon Button on DATA Tab -->
          <ExtensionPoint xsi:type="PrimaryCommandSurface">
            <OfficeTab id="TabData">
              <Group id="CloudExtend.Group">
                <Label resid="CloudExtend.Group.Label"/>

                <Icon>
                  <bt:Image size="16" resid="Icon.16x16"/>
                  <bt:Image size="32" resid="Icon.32x32"/>
                  <bt:Image size="80" resid="Icon.80x80"/>
                </Icon>

                <Control xsi:type="Button" id="CloudExtend.TaskpaneButton">
                  <Label resid="Taskpane.Button.Label"/>
                  <Supertip>
                    <Title resid="Taskpane.Button.Label"/>
                    <Description resid="Taskpane.Button.Description"/>
                  </Supertip>
                  <Icon>
                    <bt:Image size="16" resid="Icon.16x16"/>
                    <bt:Image size="32" resid="Icon.32x32"/>
                    <bt:Image size="80" resid="Icon.80x80"/>
                  </Icon>
                  <Action xsi:type="ShowTaskpane">
                    <TaskpaneId>CloudExtend.Taskpane</TaskpaneId>
                    <SourceLocation resid="Taskpane.Url"/>
                  </Action>
                </Control>

              </Group>
            </OfficeTab>
          </ExtensionPoint>

          <!-- Context Menu -->
          <ExtensionPoint xsi:type="ContextMenu">
            <OfficeMenu id="ContextMenuCell">

              <Control xsi:type="Menu" id="CloudExtend.ContextMenu">
                <Label resid="ContextMenu.Label"/>
                <Supertip>
                  <Title resid="ContextMenu.Label"/>
                  <Description resid="ContextMenu.Description"/>
                </Supertip>
                <Icon>
                  <bt:Image size="16" resid="Icon.16x16"/>
                  <bt:Image size="32" resid="Icon.32x32"/>
                  <bt:Image size="80" resid="Icon.80x80"/>
                </Icon>

                <Items>
                  <Item id="CloudExtend.DrillDown">
                    <Label resid="DrillDown.Label"/>
                    <Supertip>
                      <Title resid="DrillDown.Label"/>
                      <Description resid="DrillDown.Description"/>
                    </Supertip>
                    <Icon>
                      <bt:Image size="16" resid="Icon.16x16"/>
                      <bt:Image size="32" resid="Icon.32x32"/>
                      <bt:Image size="80" resid="Icon.80x80"/>
                    </Icon>

                    <!-- ExecuteFunction runs in sharedruntime.html (blank page) -->
                    <!-- Sets localStorage flag, then shows taskpane -->
                    <Action xsi:type="ExecuteFunction">
                      <FunctionName>drillDownFromContextMenu</FunctionName>
                    </Action>

                  </Item>
                </Items>

              </Control>

            </OfficeMenu>
          </ExtensionPoint>

        </DesktopFormFactor>

      </Host>
    </Hosts>

    <Resources>

      <!-- Icons -->
      <bt:Images>
        <bt:Image id="Icon.16x16" DefaultValue="https://chris-cloudextend.github.io/netsuite-excel-addin/icon-16.png?v=3.0.5.233"/>
        <bt:Image id="Icon.32x32" DefaultValue="https://chris-cloudextend.github.io/netsuite-excel-addin/icon-32.png?v=3.0.5.233"/>
        <bt:Image id="Icon.80x80" DefaultValue="https://chris-cloudextend.github.io/netsuite-excel-addin/icon-80.png?v=3.0.5.233"/>
      </bt:Images>

      <!-- External Files (cache-busted) -->
      <bt:Urls>
        <bt:Url id="Taskpane.Url" DefaultValue="https://chris-cloudextend.github.io/netsuite-excel-addin/taskpane.html?v=3.0.5.233"/>
        <bt:Url id="DrillDown.Url" DefaultValue="https://chris-cloudextend.github.io/netsuite-excel-addin/taskpane.html?v=3.0.5.233&amp;action=drilldown"/>
        <bt:Url id="SharedRuntime.Url" DefaultValue="https://chris-cloudextend.github.io/netsuite-excel-addin/sharedruntime.html?v=3.0.5.233"/>
        <bt:Url id="Functions.Script.Url" DefaultValue="https://chris-cloudextend.github.io/netsuite-excel-addin/functions.js?v=3.0.5.233"/>
        <bt:Url id="Functions.Metadata.Url" DefaultValue="https://chris-cloudextend.github.io/netsuite-excel-addin/functions.json?v=3.0.5.233"/>
        <bt:Url id="GetStarted.LearnMoreUrl" DefaultValue="https://www.cloudextend.io"/>
      </bt:Urls>

      <!-- Strings -->
      <bt:ShortStrings>
        <bt:String id="Functions.Namespace" DefaultValue="XAVI"/>
        <bt:String id="CloudExtend.Group.Label" DefaultValue="CloudExtend"/>
        <bt:String id="Taskpane.Button.Label" DefaultValue="XAVI"/>
        <bt:String id="ContextMenu.Label" DefaultValue="CloudExtend"/>
        <bt:String id="DrillDown.Label" DefaultValue="View Transactions"/>
        <bt:String id="GetStarted.Title" DefaultValue="XAVI for NetSuite"/>
      </bt:ShortStrings>

      <bt:LongStrings>
        <bt:String id="Taskpane.Button.Description" DefaultValue="Open the CloudExtend task pane for NetSuite formulas"/>
        <bt:String id="ContextMenu.Description" DefaultValue="CloudExtend formula tools"/>
        <bt:String id="DrillDown.Description" DefaultValue="View underlying transactions for this balance"/>
        <bt:String id="GetStarted.Description" DefaultValue="Financial reporting formulas for NetSuite"/>
      </bt:LongStrings>

    </Resources>

  </VersionOverrides>

</OfficeApp>
